<h1>GGP Production Startup &amp; Control Runbook</h1><p>This document formalizes the&nbsp;<strong>production-grade startup, control, and operating procedures</strong>&nbsp;for bringing up, validating, and operating the GGP platform on a PowerEdge host using Docker Compose.</p><p>It is written as a&nbsp;<strong>runbook + control framework</strong>, not just a technical how-to.</p><hr><ol><li>Operating principles (non-negotiable)</li></ol><hr><p>These principles drive every control below:</p><ol><li> <strong>Infrastructure before applications</strong><li>  Data and event backbone must be healthy&nbsp;<i>before</i>&nbsp;apps start.</li></li><li> <strong>Deterministic startup</strong><li>  Same steps, same order, every time.</li></li><li> <strong>Read-only safety by default</strong><li>  Ability to pause writes and workflows without stopping the system.</li></li><li> <strong>Idempotency everywhere</strong><li>  Any step may be retried without corrupting state.</li></li><li> <strong>Observability is mandatory</strong><li>  No blind startups; metrics, logs, and traces must be visible before declaring “up”.</li></li><li> <strong>Fail closed, not open</strong><li>  If a dependency is unhealthy, downstream services must not silently proceed.</li></li></ol><hr><ol start="2"><li>Environment tiers (single-host aware)</li></ol><hr><p>Even on one PowerEdge, treat environments distinctly:</p><ul><li>  <strong>LOCAL</strong>&nbsp;– laptop/dev machine</li><li>  <strong>STAGE</strong>&nbsp;– same topology as prod, smaller data</li><li>  <strong>PROD</strong>&nbsp;– PowerEdge canonical instance</li></ul><p>Controls must assume&nbsp;<strong>PROD discipline</strong>, even if STAGE runs on the same hardware.</p><hr><ol start="3"><li>Pre-start controls (gate 0)</li></ol><hr><h3>3.1 Host integrity checks</h3><p><strong>Operator checklist (manual or scripted):</strong></p><ul><li>  Disk free space &gt; 25% on&nbsp;<code>/data/ggp</code></li><li>  Docker daemon running</li><li>  System clock synced (chrony)</li><li>  No degraded RAID state</li><li>  CPU load &lt; 70% sustained</li><li>  Memory headroom &gt; 20%</li></ul><p><strong>Control</strong>: startup&nbsp;<strong>must abort</strong>&nbsp;if any hard threshold fails.</p><hr><h3>3.2 Configuration integrity</h3><ul><li>  <code>.env</code>&nbsp;file present</li><li>  <code>.env</code>&nbsp;permissions =&nbsp;<code>600</code></li><li>  Required variables set (fail fast):<li>  DB credentials</li><li>  Kafka bootstrap</li><li>  Domain + ACME email</li><li>  OTel endpoint</li></li></ul><p><strong>Control</strong>: preflight script validates env before Compose is invoked.</p><hr><ol start="4"><li>Startup sequence (authoritative order)</li></ol><hr><h3>Phase 1 — Infrastructure bring-up</h3><p><strong>Required health gates:</strong></p><p><strong>Control:</strong></p><ul><li>  Do&nbsp;<strong>not</strong>&nbsp;proceed until all gates pass</li><li>  Kafka UI must show broker online</li></ul><hr><h3>Phase 2 — Observability bring-up</h3><p><strong>Required health gates:</strong></p><p><strong>Control:</strong></p><ul><li>  No apps start until observability is live</li></ul><hr><h3>Phase 3 — Database migration gate</h3><p><strong>Rules:</strong></p><ul><li>  Migrations run&nbsp;<strong>once per deploy</strong></li><li>  Failure halts startup</li><li>  No API starts if migrations fail</li></ul><p><strong>Control:</strong></p><ul><li>  Migration container must exit&nbsp;<code>0</code></li></ul><hr><h3>Phase 4 — Application startup</h3><p>Startup order (implicit via dependencies):</p><ol><li> API</li><li> Projection consumer</li><li> Audit consumer</li><li> Workflow consumer</li><li> Scheduler</li><li> Frontend</li></ol><hr><ol start="5"><li>Application-level safety controls</li></ol><hr><h3>5.1 Write control (kill switch)</h3><p>The API must support:</p><ul><li>  <code>READ\_ONLY\_MODE=true</code></li></ul><p>When enabled:</p><ul><li>  All write endpoints return&nbsp;<code>503</code>&nbsp;or&nbsp;<code>409</code></li><li>  Events are not emitted</li><li>  Consumers continue to drain</li></ul><p><strong>Use cases:</strong></p><ul><li>  Hotfix deployment</li><li>  Projection rebuild</li><li>  Incident containment</li></ul><hr><h3>5.2 Workflow control</h3><p>Workflow consumer must support:</p><ul><li>  <code>WORKFLOWS_ENABLED=false</code></li></ul><p>When disabled:</p><ul><li>  Commands are acknowledged</li><li>  No side effects occur</li><li>  Audit still records receipt</li></ul><hr><h3>5.3 Consumer idempotency</h3><p><strong>Mandatory rules:</strong></p><ul><li>  Every consumer records processed&nbsp;<code>event_id</code></li><li>  Replays must not duplicate writes</li><li>  Mongo writes are&nbsp;<strong>upserts only</strong></li></ul><hr><ol start="6"><li>Observability acceptance criteria</li></ol><hr><p>System is considered&nbsp;<strong>UP</strong>&nbsp;only when:</p><ul><li>  API&nbsp;<code>/health</code>&nbsp;returns healthy</li><li>  Kafka consumer lag &lt; defined threshold</li><li>  Mongo projection counts are non-zero</li><li>  Audit table receiving events</li><li>  No sustained error spikes in logs</li></ul><p><strong>Control:</strong></p><ul><li>  “Up” declaration is a conscious operator action</li></ul><hr><ol start="7"><li>Replay &amp; recovery controls</li></ol><hr><h3>7.1 Projection rebuild</h3><p><strong>Allowed only when:</strong></p><ul><li>  API in read-only mode</li><li>  Workflows disabled</li></ul><p><strong>Procedure:</strong></p><ol><li> Stop projection consumer</li><li> Drop or version read-model collections</li><li> Reset consumer offsets</li><li> Start projection consumer in replay mode</li><li> Verify counts + dashboards</li><li> Re-enable writes/workflows</li></ol><hr><h3>7.2 DLQ reprocessing</h3><ul><li>  DLQ topics are&nbsp;<strong>never auto-consumed</strong></li><li>  Replays are explicit operator actions</li><li>  Replayed events are tagged with&nbsp;<code>replayed=true</code></li></ul><hr><ol start="8"><li>Change management controls</li></ol><hr><h3>8.1 Deployment rules</h3><ul><li>  Infra changes ≠ app changes</li><li>  One change class per deploy</li><li>  Rollback plan defined&nbsp;<i>before</i>&nbsp;deploy</li></ul><hr><h3>8.2 Versioning</h3><ul><li>  Containers are versioned (<code>ggp-api:0.x.y</code>)</li><li>  No&nbsp;<code>latest</code>&nbsp;in PROD</li><li>  Schema version increments are explicit</li></ul><hr><ol start="9"><li>Backup &amp; data safety</li></ol><hr><h3>9.1 Backup guarantees</h3><ul><li>  Postgres: daily logical backups</li><li>  Mongo: daily dumps</li><li>  Retention: minimum 14 days</li></ul><p><strong>Control:</strong></p><ul><li>  Backup success metrics scraped by Prometheus</li></ul><hr><ol start="10"><li>Incident response (minimal but real)</li></ol><hr><h3>Severity levels</h3><ul><li>  <strong>SEV-1</strong>: data corruption, Kafka loss</li><li>  <strong>SEV-2</strong>: API unavailable</li><li>  <strong>SEV-3</strong>: degraded performance</li></ul><h3>Immediate actions</h3><ul><li>  Enable read-only mode</li><li>  Freeze workflows</li><li>  Preserve logs + metrics</li></ul><hr><ol start="11"><li>Shutdown procedure (clean)</li></ol><hr><p><strong>Never</strong>&nbsp;reverse this order.</p><hr><ol start="12"><li>Control checklist (operator sign-off)</li></ol><hr><p>Before declaring PROD live:</p><ul><li></li></ul><hr><ol start="13"><li>Future hardening (tracked separately)</li></ol><hr><ul><li>  mTLS between services</li><li>  Secrets manager</li><li>  Multi-node Kafka</li><li>  Postgres replication</li><li>  Automated drift detection</li></ul><hr><p><strong>This runbook is the authoritative startup and control contract for GGP.</strong></p><br>